---
import { API_URL, WEBSITE } from '../../../utils/constants';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getReviewsByServiceWithBackfill } from '../../../utils/reviews';
import type { Review, Service } from '../../../utils/types';

const title = 'EVO Plumbing and Heating';
const description = 'EVO Plumbing and Heating.';

// Generate a new path for every service
export async function getStaticPaths() {
	const services = await fetch(`${API_URL}/services/website/${WEBSITE}`).then((response) =>
		response.json()
	);

	return services.map((service: Service) => {
		return {
			params: { serviceSlug: service.slug },
			props: { service }
		};
	});
}

const { service } = Astro.props;

const reviews: Review[] = await getReviewsByServiceWithBackfill(service.id);
---

<BaseLayout title={title} description={description}>
	<h1>{service.name}</h1>
	<h2>{reviews.length} reviews</h2>
	{
		reviews.map((review) => (
			<p>
				{review.id}, {review.date}, {review.title}, {review.postcode}
			</p>
		))
	}
</BaseLayout>
